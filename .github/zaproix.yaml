name: CI
on:
  push:
    branches: [ "devtest3" ]
  pull_request:
    branches: [ "devtest3" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: OWASP ZAP Baseline Scan
        uses: zaproxy/action-baseline@v0.7.0
        with:
          target: "http://juice.hostdevtest.shop"


      - name: Start ZAP Scan
        run: |
          docker pull owasp/zap2docker-stable
          docker run -u zap -v $(pwd):/zap/wrk/:rw -t owasp/zap2docker-stable zap-baseline.py -t http://juice.hostdevtest.shop -r zap_report.html
        entrypoint: [""]
        variables:
        ZAP_ALERT_REPORT: alert-report
        ZAP_REPORT: baselinescan
        USERNAME: admin@admin.com
        ASSWORD: admin
  script:
    - bash zap_scan.sh

    - name: Upload ZAP Report
      uses: actions/upload-artifact@v3
      with:
        name: ZAP Report
        path: zap_report.html

