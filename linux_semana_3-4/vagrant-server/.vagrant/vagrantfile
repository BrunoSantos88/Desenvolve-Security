Vagrant.configure("2") do |config|
    config.vm.box = "ubuntu/focal64"
  
    config.vm.provider "virtualbox" do |vb|
      vb.memory = "2048" # Configuração de memória atualizada para 2GB
    end
  
    config.vm.network "public_network", bridge: "TP-Link Wireless USB Adapter", ip: "192.168.15.7"
    config.vm.network "forwarded_port", guest: 22, host: 2222, id: "ssh"
    config.vm.network "forwarded_port", guest: 80, host: 8080, id: "http"
    config.vm.network "forwarded_port", guest: 25, host: 25, id: "smtp"
    config.vm.network "forwarded_port", guest: 587, host: 587, id: "smtp"
    config.vm.network "forwarded_port", guest: 465, host: 465, id: "smtp"
    config.vm.network "forwarded_port", guest: 2525, host: 2525, id: "smtp"
    config.vm.network "forwarded_port", guest: 3306, host: 3306, id: "mysql"
  
    config.vm.provision "shell", inline: <<-SHELL
      # Adiciona a chave pública para o usuário 'vagrant'
      echo 'PasswordAuthentication yes' | sudo tee -a /etc/ssh/sshd_config
      sudo systemctl restart sshd
      # Adiciona a chave pública para o usuário 'vagrant'
      mkdir -p /home/vagrant/.ssh
      echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCsWY5onamLJt1f3ZvVguYsgdY5NEPEvucHXuyFqIyP88qfhqPfrl5c/WNgMyG468II/lj+5Pm4KhTCV96py51M+RvpzTVHzfliwxvEBfa6nlmP28jfUotNzgQnbNavtO5zmk/MwjDgJJpKe9OeXbnzPm//LdRlhfG64pvmJpBhGLb2/gld0ygxbrgDszmcB2vX0uvyJ3h6NcAyl+KtowQZrCSKK++ESJr3BNgn+0vPhViG2ojYq+oUtR4ZSetpZRK3lSETVS68L1Idhnp0LscuWt3Wd38rX1hT7NOnfUe7cAs8ixXw/3coJyfsYVRx8TGY7haTxL76np6dynj2JeojfnIdrZOpTqFAiHXtvEIe7f4DNjoMZlmnuqEwchYkSlH1gTn/RZOtHgeDmWgmXmg7onyT08eJnn3X6eTCt8k2L7m2ZHQX0P5R1MDCSOcqaRbcjKpVEDGHJmIMSECE2IkZb8VIXKwvyjwlZKSKi06GiA9Gl4JlQyhEYbln7MdaMoD118up7s+yZiHWQgON0P9v74pt1B6iEodTdeiJoRA08mbw0N1hVenvwoGYGHRZamJmj7m43lDXEOWPooUpmifI8WRxTeRuTyKqtKMIzNZbnzRexr0emga19s8JrJDBBOGh9PHYVI/BFZ5RZF7+RpgCtJ8o1fr4/LmsNEySzlj8kw== brunosantosc1@gmail.com" >> /home/vagrant/.ssh/authorized_keys
      chown -R vagrant:vagrant /home/vagrant/.ssh
      chmod 700 /home/vagrant/.ssh
      chmod 600 /home/vagrant/.ssh/authorized_keys
      sudo cp /vagrant/imagens-livros.zip /home/ubuntu
  
      # Instalação de pacotes necessários
      sudo apt-get update -y
      sudo apt-get install -y python3 python3-pip
      sudo -H pip3 install --upgrade pip
      sudo apt-get install ansible -y
      sudo apt-get install -y apache2
      sudo apt-get install ssmtp -y
      sudo apt-get install mailutils -y
      sudo apt-get install nmap -y
      sudo apt install iptables -y
  
      # Instalação do MySQL e criação do banco de dados e tabelas
      sudo apt-get install -y mysql-server
      sudo mysql -e "CREATE DATABASE mutillidae;"
  
      # Comando SQL para criar a tabela produtos
      sudo mysql -e "USE mutillidae; CREATE TABLE produtos (
        id INT PRIMARY KEY AUTO_INCREMENT,
        nome VARCHAR(255) NOT NULL,
        descricao TEXT,
        preco DECIMAL(10, 2) NOT NULL
      );"
      # Comando SQL para criar a tabela usuarios
      sudo mysql -e "USE mutillidae; CREATE TABLE usuarios (
        id INT PRIMARY KEY AUTO_INCREMENT,
        nome VARCHAR(255) NOT NULL,
        email VARCHAR(255) NOT NULL,
        senha VARCHAR(255) NOT NULL
      );"
    SHELL
  end