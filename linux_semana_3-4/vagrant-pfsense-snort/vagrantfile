Vagrant.configure("2") do |config|
  config.vm.box = "freebsd/FreeBSD-13.3-RC1"

  config.vm.provider "virtualbox" do |vb|
    vb.memory = "4000"
    vb.cpus = 2
  end

  config.vm.network "public_network", bridge: "TP-Link Wireless USB Adapter", ip: "192.168.15.6"

  config.vm.network "forwarded_port", guest: 22, host: 2222, protocol: "tcp"
  config.vm.network "forwarded_port", guest: 80, host: 8080, protocol: "tcp"

  config.vm.provision "shell", inline: <<-SHELL
    # Cria o usuário "bruno" com privilégios administrativos
    sudo adduser -w root bruno
    sudo passwd bruno root88
    adduser -G bruno

    # Instalação de pacotes e configuração do Snort
    pkg install -y wget git python3 bash
    fetch https://download.freebsd.org/ftp/releases/amd64/12.1-RELEASE/src.txz
    tar -C / -xzvf src.txz
    git clone https://github.com/andrewjknox/snort
    cd snort
    ./pkg_build.sh
    ./pkg_install.sh
    /usr/local/etc/rc.d/barnyard2 start
    /usr/local/etc/rc.d/snort start
SHELL
end